{% extends "base.html" %}

{% block title %}{{ char.name }} - AI Dungeon Master{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <div>
            <h1>{{ char.name }}</h1>
            <p>
                <span class="tag tag-race">{{ char.race or 'Unknown Race' }}</span>
                <span class="tag tag-class">{{ char.class or 'Unknown Class' }}</span>
                <span class="tag tag-level">Level {{ char.level or 1 }}</span>
            </p>
        </div>
        <a href="{{ url_for('portal.edit_character', char_id=char_id) }}" class="btn btn-primary">‚úèÔ∏è Edit</a>
    </div>
    
    <!-- HP Bar -->
    <div class="form-group">
        <label>Hit Points</label>
        {% set hp_percent = ((char.hp or 0) / (char.max_hp or 1) * 100) | int %}
        <div class="hp-bar">
            <div class="hp-bar-fill" style="width: {{ hp_percent }}%"></div>
            <div class="hp-bar-text">{{ char.hp or 0 }} / {{ char.max_hp or 0 }}</div>
        </div>
    </div>
</div>

<!-- Ability Scores -->
<div class="card">
    <h2>‚öîÔ∏è Ability Scores</h2>
    <br>
    <div class="grid grid-6">
        {% for stat in ['STR', 'DEX', 'CON', 'INT', 'WIS', 'CHA'] %}
        {% set value = char.get(stat, 10) %}
        {% set mod = ((value - 10) // 2) %}
        <div class="stat-box">
            <div class="stat-name">{{ stat }}</div>
            <div class="stat-value">{{ value }}</div>
            <div class="stat-mod">{% if mod >= 0 %}+{% endif %}{{ mod }}</div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Combat Stats -->
<div class="card">
    <h2>üõ°Ô∏è Combat Stats</h2>
    <br>
    <div class="grid grid-3">
        <div class="stat-box">
            <div class="stat-name">Armor Class</div>
            <div class="stat-value">{{ char.ac or 10 }}</div>
        </div>
        <div class="stat-box">
            <div class="stat-name">Initiative</div>
            {% set dex_mod = ((char.get('DEX', 10) - 10) // 2) %}
            <div class="stat-value">{% if dex_mod >= 0 %}+{% endif %}{{ dex_mod }}</div>
        </div>
        <div class="stat-box">
            <div class="stat-name">Proficiency</div>
            {% set prof = 2 + ((char.level or 1) - 1) // 4 %}
            <div class="stat-value">+{{ prof }}</div>
        </div>
    </div>
</div>

<!-- Inventory -->
<div class="card">
    <div class="card-header">
        <h2>üéí Inventory</h2>
    </div>
    
    {% if char.inventory %}
    <div class="inventory-grid">
        {% for item in char.inventory %}
        <div class="inventory-item">
            <span>{{ item }}</span>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state" style="padding: 30px;">
        <p>No items in inventory.</p>
    </div>
    {% endif %}
</div>

<!-- Experience -->
{% if char.xp is defined %}
<div class="card">
    <h2>‚≠ê Experience</h2>
    <br>
    <div class="stat-box">
        <div class="stat-name">XP</div>
        <div class="stat-value">{{ char.xp or 0 }}</div>
    </div>
</div>
{% endif %}

<br>
<a href="{{ url_for('portal.list_characters') }}" class="btn btn-secondary">‚Üê Back to Characters</a>
{% endblock %}
